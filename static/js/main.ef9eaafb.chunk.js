(this["webpackJsonphours-summary"]=this["webpackJsonphours-summary"]||[]).push([[0],{14:function(e,t,n){e.exports=n(28)},20:function(e,t,n){},21:function(e,t,n){},28:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"fetchAllSheets",(function(){return j})),n.d(a,"setHoursSheetId",(function(){return x})),n.d(a,"getHoursSheet",(function(){return I})),n.d(a,"getHoursSheetId",(function(){return T})),n.d(a,"fetchHours",(function(){return W}));var r=n(0),s=n.n(r),i=n(11),o=n.n(i),c=(n(19),n(20),n(2)),u=(n(21),n(4)),l={error:null,isLoggedIn:!1,isPending:!1,user:null},d=function(e,t){switch(t.type){case"ERROR":return Object(u.a)({},e,{error:t.error,isPending:!1});case"LOGOUT":return Object(u.a)({},e,{isLoggedIn:!1,isPending:!1,user:null});case"PENDING":return Object(u.a)({},e,{isPending:!0});case"SUCCESS":return Object(u.a)({},e,{isLoggedIn:!0,isPending:!1,user:t.user});default:throw new Error("Invalid action type: ".concat(t.type))}},m=s.a.createContext([]),f=function(e){var t=Object(r.useReducer)(d,l),n=Object(c.a)(t,2),a=n[0],i=n[1];return s.a.createElement(m.Provider,Object.assign({value:[a,i]},e))},h=function(){return Object(r.useContext)(m)},p=n(3),g=n.n(p),v=n(7),y=v.GOOGLE_API_KEY,E=v.GOOGLE_CLIENT_ID,b="https://www.googleapis.com/auth/spreadsheets.readonly",w="https://www.googleapis.com/auth/drive.metadata.readonly",O=["https://sheets.googleapis.com/$discovery/rest?version=v4","https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],D=function(){return window.gapi.auth2.getAuthInstance()},k=[],S=function(){return new Date(parseInt(localStorage.getItem("hours-data-loaded-at")))},N=function(e){return localStorage.setItem("hours-data-loaded-at",e.getTime())},j=function(){return new Promise((function(e,t){window.gapi.client.drive.files.list({fields:"nextPageToken, files(id, name, webViewLink, iconLink)",q:'mimeType="application/vnd.google-apps.spreadsheet"'}).then((function(n){var a=n.result.files;if(!a||a.length<1)return t(new Error("No Google Sheets!"));k=a,e(a)}),t)}))},x=function(e){return localStorage.setItem("hours-sheet",JSON.stringify(k.find((function(t){return t.id===e}))))},I=function(){try{var e=window.localStorage.getItem("hours-sheet");return e&&JSON.parse(e)}catch(t){return null}},T=function(){var e=I();return e&&e.id},L=function(e){var t=86400*e-2209161600,n=new Date;return n.setTime(1e3*t),n.setMinutes(n.getTimezoneOffset()+n.getMinutes()),n},C=function(e){var t={};return t.timestamp=L(parseFloat(e[0])),t.startDateTime=L(parseFloat(e[1])+parseFloat(e[2])),t.endDateTime=L(parseFloat(e[1])+parseFloat(e[3])),t.notes=e[4].trim(),t},W=function(){return new Promise((function(e,t){if((new Date).getTime()-S().getTime()<6e4)e(JSON.parse(localStorage.getItem("hours-data")).map((function(e){return Object(u.a)({},e,{timestamp:new Date(e.timestamp),startDateTime:new Date(e.startDateTime),endDateTime:new Date(e.endDateTime)})})));else{var n={spreadsheetId:T(),range:"A:E",valueRenderOption:"UNFORMATTED_VALUE",dateTimeRenderOption:"SERIAL_NUMBER"};window.gapi.client.sheets.spreadsheets.values.get(n).then((function(t){var n=t.result.values.slice(1).map(C);N(new Date),localStorage.setItem("hours-data",JSON.stringify(n)),e(n)}),t)}}))},G=n(12),P=function(e){return e/36e5},F=function(e){return["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][e.getDay()]},_=function(e){var t=new Date(e.getTime());return t.setMilliseconds(0),t.setSeconds(0),t.setMinutes(0),t.setHours(0),t.setDate(t.getDate()-t.getDay()),t},A=function(e,t){return R(e,-t)},R=function(e,t){var n=new Date(e.getTime());return n.setDate(n.getDate()+t),n};var H=function(e){var t,n=e.sheetsApi,a=_(new Date),r=!1,s=[];function i(){var e={currentWeek:{hours:0},currentDay:{hours:0},previousWeek:{hours:0},sunday:{hours:0},monday:{hours:0},tuesday:{hours:0},wednesday:{hours:0},thursday:{hours:0},friday:{hours:0},saturday:{hours:0}};return o(a).forEach((function(t){var n=t.startDateTime,a=t.endDateTime,r=P(a-n);e[F(n)].hours+=r,e.currentWeek.hours+=r})),e.previousWeek.hours=o(A(a,7)).reduce((function(e,t){var n=t.startDateTime,a=t.endDateTime;return e+P(a-n)}),0),e.currentDay.hours=e[F(new Date)].hours,e}function o(e){var t=new Date(e.getTime());return t.setDate(e.getDate()+7),s.filter((function(n){var a=n.startDateTime;return a>=e&&a<t}))}return Object.freeze({isLoaded:function(){return r},load:function(){return n.fetchHours().then((function(e){r=!0,s.push.apply(s,Object(G.a)(e)),e.length>0&&(t=_(function(e){return e.reduce((function(e,t){return t.startDateTime<e.startDateTime?t:e}))}(s).startDateTime))})).catch(console.error)},next:function(){var e=R(a,7);if(!(Date.now()<e.getTime()))return a=e,i()},previous:function(){var e=A(a,7);if(!(e<t))return a=e,i()},set_week:function(e){a=_(e)},totals:i})},U=n(8),J=n(5),M=function(e){return s.a.createElement(U.a,Object.assign({},e,{icon:J.c}))},z=function(e){var t=e.direction,n=e.props;return s.a.createElement(U.a,Object.assign({},n,{icon:"right"===t?J.b:J.a}))},B=function(e){var t=e.name,n=e.id,a=e.onClick;return s.a.createElement("button",{className:"list-group-item list-group-item-action h6",type:"button",onClick:a},s.a.createElement("img",{src:"https://drive-thirdparty.googleusercontent.com/16/type/application/vnd.google-apps.spreadsheet","aria-hidden":"true",className:"mr-2",alt:""}),t,s.a.createElement("a",{className:"web-view-link pl-2",href:"https://docs.google.com/spreadsheets/d/".concat(n,"/edit?usp=drivesdk"),"aria-label":"Open sheet in new tab",target:"_blank",rel:"noopener noreferrer"},s.a.createElement(M,null)))},K=function(e){var t=e.sheets,n=e.onSheetSelect;return s.a.createElement("div",{className:"list-group list-group-flush"},t.map((function(e){return s.a.createElement(B,Object.assign({key:e.id},e,{onClick:function(){return n(e.id)}}))})))},Y=function(e){var t=e.onSheetSelect,n=Object(r.useState)([]),a=Object(c.a)(n,2),i=a[0],o=a[1];return Object(r.useEffect)((function(){!function(){var e;g.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g.a.awrap(j());case 2:e=t.sent,o(e);case 4:case"end":return t.stop()}}))}()}),[]),s.a.createElement(K,{onSheetSelect:t,sheets:i})},V=n(13),$=function(e){var t=e.sheetId;return s.a.createElement("a",{href:"https://docs.google.com/spreadsheets/d/".concat(t,"/edit?usp=drivesdk"),id:"external-link-hours-sheet",className:"btn btn-secondary",target:"_blank",rel:"noopener noreferrer"},"View Hours Sheet ",s.a.createElement(M,null))},q=function(e){var t=e.value,n=void 0===t?0:t,a=e.min,r=void 0===a?0:a,i=e.max,o=void 0===i?100:i,c=100*(n-r)/(o-r);return s.a.createElement("div",{className:"progress",style:{maxWidth:400}},s.a.createElement("div",{style:{width:"".concat(c,"%")},className:"progress-bar",role:"progressbar","aria-valuenow":n.toFixed(1),"aria-valuemin":r.toFixed(),"aria-valuemax":o.toFixed()},n.toFixed(1)," / ",o.toFixed()))},Q=function(e){var t=e.header,n=e.data,a=e.isToday;return s.a.createElement("tr",{className:a?"table-primary":""},s.a.createElement("th",{className:"text-capitalize"},t," ",a&&s.a.createElement("span",{className:"ml-2 badge badge-primary"},"Today!")),s.a.createElement("td",null,n))},X=function(e){var t=e.tableData,n=void 0===t?[]:t;return s.a.createElement("table",{className:"table mt-5",style:{maxWidth:400}},s.a.createElement("tbody",null,n.map((function(e){return s.a.createElement(Q,Object.assign({key:e.header},e))}))))},Z=function(e){return s.a.createElement("span",Object.assign({role:"button",style:{cursor:"pointer"}},e))},ee=function(e){var t=e.onClick;return s.a.createElement(Z,{onClick:t},s.a.createElement(z,{direction:"right"}))},te=function(e){var t=e.onClick;return s.a.createElement(Z,{onClick:t},s.a.createElement(z,{direction:"left"}))},ne=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],ae=function(e){var t=e.sheetId,n=e.currentWeek,a=(e.previousWeek,e.currentDay,e.firstDay),r=e.isFirstWeek,i=e.onPreviousWeek,o=e.onNextWeek,c=Object(V.a)(e,["sheetId","currentWeek","previousWeek","currentDay","firstDay","isFirstWeek","onPreviousWeek","onNextWeek"]),u=n.hours,l=ne[(new Date).getDay()],d=R(a,7),m=Date.now()>a.getTime()&&Date.now()<R(d,1),f=ne.map((function(e){return{header:e,data:c[e].hours.toFixed(2),isToday:e===l&&m}}));return s.a.createElement(s.a.Fragment,null,s.a.createElement($,{sheetId:t}),s.a.createElement("div",{className:"mt-5"},s.a.createElement("h2",{className:"h5 pt-3 text-dark"},r||s.a.createElement(te,{onClick:i}),s.a.createElement("span",{className:"px-3"},a.toLocaleDateString()," - ",d.toLocaleDateString()),m||s.a.createElement(ee,{onClick:o})),s.a.createElement(q,{value:u,max:40})),s.a.createElement(X,{tableData:f}))},re=function(){return s.a.createElement("div",{className:"vh-100 d-flex justify-content-center align-items-center"},s.a.createElement("div",{style:{width:"5rem",height:"5rem"},className:"spinner-border",role:"status"},s.a.createElement("span",{className:"sr-only"},"Loading...")))},se=function(e){var t=e.children;return s.a.createElement("div",{className:"container mt-3"},t)},ie=function(e){var t=e.hours,n=h(),a=Object(c.a)(n,1)[0],i=Object(r.useState)(I()),o=Object(c.a)(i,2),u=o[0],l=o[1],d=Object(r.useState)(),m=Object(c.a)(d,2),f=m[0],p=m[1],v=Object(r.useState)(_(new Date)),y=Object(c.a)(v,2),E=y[0],b=y[1],w=Object(r.useState)(!1),O=Object(c.a)(w,2),D=O[0],k=O[1];Object(r.useEffect)((function(){g.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(!u){e.next=3;break}return e.next=3,g.a.awrap(t.load());case 3:t.isLoaded()&&p(t.totals());case 4:case"end":return e.stop()}}))}),[u,t]);return a.isLoggedIn?f?s.a.createElement(se,null,s.a.createElement(ae,Object.assign({sheetId:u.id,firstDay:E,isFirstWeek:D,onPreviousWeek:function(){var e=A(E,7),n=t.previous();void 0!==n?(k(!1),b(e),p(n)):k(!0)},onNextWeek:function(){var e=R(E,7),n=t.next();k(!1),void 0!==n&&(b(e),p(n))}},f))):u?s.a.createElement(re,null):s.a.createElement(se,null,s.a.createElement(Y,{onSheetSelect:function(e){x(e),l(I())}})):s.a.createElement(se,null,"Please log in.")},oe=function(e){var t=e.isGapiClientLoaded,n=h(),a=Object(c.a)(n,2),i=a[0],o=a[1];return Object(r.useEffect)((function(){if(o({type:"PENDING"}),t){var e=function(e){o(e?{type:"SUCCESS",user:D().currentUser.get()}:{type:"LOGOUT"})};try{var n=D();n.isSignedIn.listen(e),e(n.isSignedIn.get())}catch(a){o({type:"ERROR",error:a.message})}}}),[o,t]),i.isPending?s.a.createElement("button",{onClick:function(){return D().signIn()},className:"btn btn-outline-primary ml-auto my-2 my-sm-0",disabled:!0},s.a.createElement("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"})," ","Loading..."):i.isLoggedIn?s.a.createElement("button",{onClick:function(){return D().signOut()},className:"btn btn-outline-danger ml-auto my-2 my-sm-0"},"Sign Out"):s.a.createElement("button",{onClick:function(){return D().signIn()},className:"btn btn-outline-primary ml-auto my-2 my-sm-0"},"Sign In with Google")},ce=function(e){var t=e.isGapiClientLoaded;return s.a.createElement("nav",{className:"navbar navbar-expand-md navbar-dark bg-dark"},s.a.createElement("a",{className:"navbar-brand",href:"./index.html"},"My Hours Summary")," ",s.a.createElement(oe,{isGapiClientLoaded:t}))};var ue=function(){var e=Object(r.useState)(!1),t=Object(c.a)(e,2),n=t[0],i=t[1],o=Object(r.useState)(null),u=Object(c.a)(o,2),l=u[0],d=u[1];return Object(r.useEffect)((function(){g.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){window.gapi.load("client:auth2",(function(){return g.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,g.a.awrap(window.gapi.client.init({clientId:E,GOOGLE_API_KEY:y,scope:[b,w].join(" "),discoveryDocs:O}));case 3:e(),n.next=9;break;case 6:n.prev=6,n.t0=n.catch(0),t(n.t0);case 9:case"end":return n.stop()}}),null,null,[[0,6]])}))})));case 1:case"end":return e.stop()}})).then((function(){return i(!0)})).catch((function(e){i(!1),d(e)}))}),[]),l?s.a.createElement("div",{className:"vh-100 d-flex justify-content-center align-items-center bg-light"},s.a.createElement("div",{className:"text-danger"},s.a.createElement("h1",{className:"display-3"},"Uh, oh!"),s.a.createElement("p",null,"An unexpected error occurred while connecting with Google. Please try again later."))):s.a.createElement(f,null,s.a.createElement(ce,{isGapiClientLoaded:n}),n?s.a.createElement(ie,{hours:H({sheetsApi:a})}):s.a.createElement(re,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(s.a.createElement(ue,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},7:function(e){e.exports=JSON.parse('{"GOOGLE_API_KEY":"AIzaSyDrOHTyZdBhmFNWdY_TX6Q5iADN0aKn1cw","GOOGLE_CLIENT_ID":"661549194387-755tit59r7uggmsctfsjkt25vhl2j1ua.apps.googleusercontent.com"}')}},[[14,1,2]]]);
//# sourceMappingURL=main.ef9eaafb.chunk.js.map