(this["webpackJsonphours-summary"]=this["webpackJsonphours-summary"]||[]).push([[0],{15:function(e,t,a){e.exports=a(29)},21:function(e,t,a){},22:function(e,t,a){},29:function(e,t,a){"use strict";a.r(t);var n={};a.r(n),a.d(n,"fetchAllSheets",(function(){return I})),a.d(n,"setHoursSheetId",(function(){return j})),a.d(n,"getHoursSheet",(function(){return x})),a.d(n,"getHoursSheetId",(function(){return T})),a.d(n,"fetchHours",(function(){return W}));var r=a(0),s=a.n(r),o=a(9),i=a.n(o),c=(a(20),a(21),a(2)),u=(a(22),a(4)),l={error:null,isLoggedIn:!1,isPending:!1,user:null},d=function(e,t){switch(t.type){case"ERROR":return Object(u.a)({},e,{error:t.error,isPending:!1});case"LOGOUT":return Object(u.a)({},e,{isLoggedIn:!1,isPending:!1,user:null});case"PENDING":return Object(u.a)({},e,{isPending:!0});case"SUCCESS":return Object(u.a)({},e,{isLoggedIn:!0,isPending:!1,user:t.user});default:throw new Error("Invalid action type: ".concat(t.type))}},m=s.a.createContext([]),h=function(e){var t=Object(r.useReducer)(d,l),a=Object(c.a)(t,2),n=a[0],o=a[1];return s.a.createElement(m.Provider,Object.assign({value:[n,o]},e))},f=function(){return Object(r.useContext)(m)},p=a(3),g=a.n(p),v=a(6),y=v.GOOGLE_API_KEY,E=v.GOOGLE_CLIENT_ID,w="https://www.googleapis.com/auth/spreadsheets.readonly",b="https://www.googleapis.com/auth/drive.metadata.readonly",O=["https://sheets.googleapis.com/$discovery/rest?version=v4","https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],D=function(){return window.gapi.auth2.getAuthInstance()},k=[],S=function(){return new Date(parseInt(localStorage.getItem("hours-data-loaded-at")))},N=function(e){return localStorage.setItem("hours-data-loaded-at",e.getTime())},I=function(){return new Promise((function(e,t){window.gapi.client.drive.files.list({fields:"nextPageToken, files(id, name, webViewLink, iconLink)",q:'mimeType="application/vnd.google-apps.spreadsheet"'}).then((function(a){var n=a.result.files;if(!n||n.length<1)return t(new Error("No Google Sheets!"));k=n,e(n)}),t)}))},j=function(e){return localStorage.setItem("hours-sheet",JSON.stringify(k.find((function(t){return t.id===e}))))},x=function(){try{var e=window.localStorage.getItem("hours-sheet");return e&&JSON.parse(e)}catch(t){return null}},T=function(){var e=x();return e&&e.id},_=function(e){var t=86400*e-2209161600,a=new Date;return a.setTime(1e3*t),a.setMinutes(a.getTimezoneOffset()+a.getMinutes()),a},L=function(e){var t={};return t.timestamp=_(parseFloat(e[0])),t.startDateTime=_(parseFloat(e[1])+parseFloat(e[2])),t.endDateTime=_(parseFloat(e[1])+parseFloat(e[3])),t.notes=e[4].trim(),t},W=function(){return new Promise((function(e,t){if((new Date).getTime()-S().getTime()<6e4)e(JSON.parse(localStorage.getItem("hours-data")).map((function(e){return Object(u.a)({},e,{timestamp:new Date(e.timestamp),startDateTime:new Date(e.startDateTime),endDateTime:new Date(e.endDateTime)})})));else{var a={spreadsheetId:T(),range:"A:E",valueRenderOption:"UNFORMATTED_VALUE",dateTimeRenderOption:"SERIAL_NUMBER"};window.gapi.client.sheets.spreadsheets.values.get(a).then((function(t){var a=t.result.values.slice(1).map(L);N(new Date),localStorage.setItem("hours-data",JSON.stringify(a)),e(a)}),t)}}))},F=a(10),P=a(11),C=function(e){return["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][e.getDay()]},G=function(){function e(t){var a=t.sheetsApi;Object(F.a)(this,e),this._sheetsApi=a,this._isHoursDataLoaded=!1}return Object(P.a)(e,[{key:"load",value:function(){var e=this;return this._sheetsApi.fetchHours().then((function(t){e._isHoursDataLoaded=!0,e._hoursData=t})).catch(console.error)}},{key:"isLoaded",value:function(){return this._isHoursDataLoaded}},{key:"totals",value:function(){var e={currentWeek:{hours:0},currentDay:{hours:0},previousWeek:{hours:0},sunday:{hours:0},monday:{hours:0},tuesday:{hours:0},wednesday:{hours:0},thursday:{hours:0},friday:{hours:0},saturday:{hours:0}},t=function(e){return e/36e5};return this.thisWeek().forEach((function(a){var n=a.startDateTime,r=a.endDateTime,s=t(r-n);e[C(n)].hours+=s,e.currentWeek.hours+=s})),e.previousWeek.hours=this.previousWeek().reduce((function(e,a){var n=a.startDateTime,r=a.endDateTime;return e+t(r-n)}),0),e.currentDay.hours=e[C(new Date)].hours,e}},{key:"thisWeek",value:function(){return this._getHoursForWeek(this._firstDayOfCurrentWeek())}},{key:"previousWeek",value:function(){var e=this._firstDayOfCurrentWeek();return e.setDate(e.getDate()-7),this._getHoursForWeek(e)}},{key:"_firstDayOfCurrentWeek",value:function(){var e=new Date;return e.setMilliseconds(0),e.setSeconds(0),e.setMinutes(0),e.setHours(0),e.setDate(e.getDate()-e.getDay()),e}},{key:"_getHoursForWeek",value:function(e){var t=new Date(e.getTime());return t.setDate(e.getDate()+7),this._hoursData.filter((function(a){var n=a.startDateTime;return n>=e&&n<t}))}}]),e}(),A=a(12),H=a(13),R=function(e){return s.a.createElement(A.a,Object.assign({},e,{icon:H.a}))},U=function(e){var t=e.name,a=e.id,n=e.onClick;return s.a.createElement("button",{className:"list-group-item list-group-item-action h6",type:"button",onClick:n},s.a.createElement("img",{src:"https://drive-thirdparty.googleusercontent.com/16/type/application/vnd.google-apps.spreadsheet","aria-hidden":"true",className:"mr-2",alt:""}),t,s.a.createElement("a",{className:"web-view-link pl-2",href:"https://docs.google.com/spreadsheets/d/".concat(a,"/edit?usp=drivesdk"),"aria-label":"Open sheet in new tab",target:"_blank",rel:"noopener noreferrer"},s.a.createElement(R,null)))},J=function(e){var t=e.sheets,a=e.onSheetSelect;return s.a.createElement("div",{className:"list-group list-group-flush"},t.map((function(e){return s.a.createElement(U,Object.assign({key:e.id},e,{onClick:function(){return a(e.id)}}))})))},M=function(e){var t=e.onSheetSelect,a=Object(r.useState)([]),n=Object(c.a)(a,2),o=n[0],i=n[1];return Object(r.useEffect)((function(){!function(){var e;g.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g.a.awrap(I());case 2:e=t.sent,i(e);case 4:case"end":return t.stop()}}))}()}),[]),s.a.createElement(J,{onSheetSelect:t,sheets:o})},B=a(14),K=function(e){var t=e.sheetId;return s.a.createElement("a",{href:"https://docs.google.com/spreadsheets/d/".concat(t,"/edit?usp=drivesdk"),id:"external-link-hours-sheet",className:"btn btn-secondary",target:"_blank",rel:"noopener noreferrer"},"View Hours Sheet ",s.a.createElement(R,null))},Y=function(e){var t=e.value,a=void 0===t?0:t,n=e.min,r=void 0===n?0:n,o=e.max,i=void 0===o?100:o,c=100*(a-r)/(i-r);return s.a.createElement("div",{className:"progress",style:{maxWidth:400}},s.a.createElement("div",{style:{width:"".concat(c,"%")},className:"progress-bar",role:"progressbar","aria-valuenow":a.toFixed(1),"aria-valuemin":r.toFixed(),"aria-valuemax":i.toFixed()},a.toFixed(1)," / ",i.toFixed()))},z=function(e){var t=e.header,a=e.data,n=e.isToday;return s.a.createElement("tr",{className:n?"table-primary":""},s.a.createElement("th",{className:"text-capitalize"},t," ",n&&s.a.createElement("span",{className:"ml-2 badge badge-primary"},"Today!")),s.a.createElement("td",null,a))},V=function(e){var t=e.tableData,a=void 0===t?[]:t;return s.a.createElement("table",{className:"table mt-5",style:{maxWidth:400}},s.a.createElement("tbody",null,a.map((function(e){return s.a.createElement(z,Object.assign({key:e.header},e))}))))},$=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],q=function(e){var t=e.sheetId,a=e.currentWeek,n=e.previousWeek,r=(e.currentDay,Object(B.a)(e,["sheetId","currentWeek","previousWeek","currentDay"])),o=a.hours,i=n.hours,c=$[(new Date).getDay()],u=$.map((function(e){return{header:e,data:r[e].hours.toFixed(2),isToday:e===c}}));return s.a.createElement(s.a.Fragment,null,s.a.createElement(K,{sheetId:t}),s.a.createElement("div",{className:"mt-5"},s.a.createElement("h2",{className:"h5 pt-3"},"Current Week:"),s.a.createElement(Y,{value:o,max:40}),s.a.createElement("p",{className:"pt-3"},i.toFixed(2)," hours last week")),s.a.createElement(V,{tableData:u}))},Q=function(){return s.a.createElement("div",{className:"vh-100 d-flex justify-content-center align-items-center"},s.a.createElement("div",{style:{width:"5rem",height:"5rem"},className:"spinner-border",role:"status"},s.a.createElement("span",{className:"sr-only"},"Loading...")))},X=function(e){var t=e.children;return s.a.createElement("div",{className:"container mt-3"},t)},Z=function(e){var t=e.hours,a=f(),n=Object(c.a)(a,1)[0],o=Object(r.useState)(x()),i=Object(c.a)(o,2),u=i[0],l=i[1],d=Object(r.useState)(!1),m=Object(c.a)(d,2),h=m[0],p=m[1];Object(r.useEffect)((function(){g.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(!u){e.next=3;break}return e.next=3,g.a.awrap(t.load());case 3:p(t.isLoaded());case 4:case"end":return e.stop()}}))}),[u,t]);return n.isLoggedIn?h?s.a.createElement(X,null,s.a.createElement(q,Object.assign({sheetId:u.id},t.totals()))):u?s.a.createElement(Q,null):s.a.createElement(X,null,s.a.createElement(M,{onSheetSelect:function(e){j(e),l(x())}})):s.a.createElement(X,null,"Please log in.")},ee=function(){var e=f(),t=Object(c.a)(e,2),a=t[0],n=t[1];return Object(r.useEffect)((function(){n({type:"PENDING"});var e=function(e){n(e?{type:"SUCCESS",user:D().currentUser.get()}:{type:"LOGOUT"})};try{var t=D();t.isSignedIn.listen(e),e(t.isSignedIn.get())}catch(a){n({type:"ERROR",error:a.message})}}),[n]),a.isPending?null:a.isLoggedIn?s.a.createElement("button",{onClick:function(){return D().signOut()},className:"btn btn-outline-danger ml-auto my-2 my-sm-0"},"Sign Out"):s.a.createElement("button",{onClick:function(){return D().signIn()},className:"btn btn-outline-primary ml-auto my-2 my-sm-0"},"Sign In with Google")},te=function(){return s.a.createElement("nav",{className:"navbar navbar-expand-md navbar-dark bg-dark"},s.a.createElement("a",{className:"navbar-brand",href:"./index.html"},"My Hours Summary")," ",s.a.createElement(ee,null))};var ae=function(){var e=Object(r.useState)(!1),t=Object(c.a)(e,2),a=t[0],o=t[1],i=Object(r.useState)(null),u=Object(c.a)(i,2),l=u[0],d=u[1];return Object(r.useEffect)((function(){g.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){window.gapi.load("client:auth2",(function(){return g.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,g.a.awrap(window.gapi.client.init({clientId:E,GOOGLE_API_KEY:y,scope:[w,b].join(" "),discoveryDocs:O}));case 3:e(),a.next=9;break;case 6:a.prev=6,a.t0=a.catch(0),t(a.t0);case 9:case"end":return a.stop()}}),null,null,[[0,6]])}))})));case 1:case"end":return e.stop()}})).then((function(){return o(!0)})).catch((function(e){o(!1),d(e)}))}),[]),a?s.a.createElement(h,null,s.a.createElement(te,null),s.a.createElement(Z,{hours:new G({sheetsApi:n})})):l?s.a.createElement("div",{className:"vh-100 d-flex justify-content-center align-items-center bg-light"},s.a.createElement("div",{className:"text-danger"},s.a.createElement("h1",{className:"display-3"},"Uh, oh!"),s.a.createElement("p",null,"An unexpected error occurred while connecting with Google. Please try again later."))):s.a.createElement(Q,null)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(s.a.createElement(ae,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},6:function(e){e.exports=JSON.parse('{"GOOGLE_API_KEY":"AIzaSyDrOHTyZdBhmFNWdY_TX6Q5iADN0aKn1cw","GOOGLE_CLIENT_ID":"661549194387-755tit59r7uggmsctfsjkt25vhl2j1ua.apps.googleusercontent.com"}')}},[[15,1,2]]]);
//# sourceMappingURL=main.e6b7607f.chunk.js.map